\pgfplotsset{
  discard if/.style 2 args={
    x filter/.append code={
      \edef\tempa{\thisrow{#1}}
      \edef\tempb{#2}
      \ifx\tempa\tempb
      \def\pgfmathresult{inf}
      \fi
    }
  },
  discard if not/.style 2 args={
    x filter/.append code={
      \edef\tempa{\thisrow{#1}}
      \edef\tempb{#2}
      \ifx\tempa\tempb
      \else
      \def\pgfmathresult{inf}
      \fi
    }
  }
}

\begin{tikzpicture}[font=\bf\sffamily\fontsize{8}{10}\selectfont]
  \def\TEXTCOL{gray}

%\draw[fill=gray,opacity=.1]
\clip (-4.65in,-2.35in) rectangle (2.2in,3in);
  
\def\DATAPATH{../../revision_results/roc/restricted_neg_len/RAW/}
\def\datafile{\DATAPATH/CHOP_PRC_pipeline_BASIC_M_100w.csv}
\def\datafilef{\DATAPATH/CHOP_PRC_pipeline_BASIC_F_100w.csv}
\def\vdatafile{\DATAPATH/CHOP_PRC_valid_BASIC_M_100w.csv}  
\def\vdatafilef{\DATAPATH/CHOP_PRC_valid_BASIC_F_100w.csv}
  \def\datafileQ{\DATAPATH/thisRFall.csv}

  \def\AXISCOL{white}
  \def\BANDCOL{lightgray}
  \def\PLOTCOLA{black}
  \def\PLOTCOLB{\MXCOL}
  \def\PLOTCOLBu{\MXCOL}
  \def\PLOTCOLC{black}
  \def\PLOTCOLD{\FXCOL}
  \def\FNCOLB{SeaGreen2}
  \def\PLOTCOLDu{\FXCOL}
  \def\WDTa{1.65in}
  \def\HGTa{1.45in}

  \def\SCALE{1.5}
  \def\SCALEA{1.25}
  \def\SCALEB{.9}
  \def\OPC{.75}
  \def\OPCB{.95}
  \def\BWIDTH{4pt}
  \def\LWDT{0.5mm}

  \def\LWDT{0.8mm}
  \def\SKIP{4}
  \def\HGT{1.625in}
  \def\WDT{1.8in}

  \tikzstyle{mopt} = [ scale=\SCALEB, , opacity=0,fill opacity=1,] 
  % \pgfplotsset{
  %   % colormap/hot,
  % colormap/viridis,
  % % colormap={reverse winter}{
  % % indices of colormap={
  % % \pgfplotscolormaplastindexof{YlGnBu},...,0 of YlGnBu}
  % % },
  % }
  \pgfplotsset{
    colormap={hot}{color(0cm)=(Orchid1); 
      color(1cm)=(DodgerBlue1); 
      color(2cm)=(DodgerBlue2); 
      color(3cm)=(orange); 
      color(4cm)=(DarkOrange1); 
      color(5cm)=(Yellow2)}
  }
  \pgfplotsset{
    colormap={hot}{color(0cm)=(MidnightBlue); 
      color(1cm)=(CadetBlue2!90!black); 
      color(2cm)=(CadetBlue1!93!black); 
      color(3cm)=(Bisque1!93!black); 
      color(4cm)=(DarkOrange1); 
      color(5cm)=(Yellow2!98!black)}
  }
  \node[] (A) {
    \begin{tikzpicture}[anchor=center,
      font=\bf\sffamily\fontsize{8}{10}\selectfont]
      \begin{groupplot}[name=Agg,
        group style={
          group name=Ag,
          group size=2 by 2,
          xlabels at=edge bottom,
          xticklabels at=edge bottom,
          vertical sep=.55in,
          horizontal sep=.55in,
        },% colormap={reverse winter}{
        % indices of colormap={
        % \pgfplotscolormaplastindexof{Spectral},...,0 of Spectral}
        % },
        grid style={thick,dashed, gray!40},%,point meta min=.9,point meta max=1,colorbar,
        % ymax=0.855
        ,legend cell align={left},
        legend style={anchor=east,at={(0.25,1.1)},
          inner sep=3pt,
          draw=none,
          fill=white,fill opacity=.850,
          align=left,anchor=west,
          text opacity=1,
          font=\bf\sffamily\fontsize{8}{9}\selectfont,text=black},
        grid style={thick,dashed, gray!40},
        grid,
        enlargelimits=false,scale only axis=true,
        scaled x ticks = false,scaled y ticks = false,
        axis line style={\AXISCOL, opacity=1,ultra  thick, 
          rounded corners=0pt}, 
        y tick label style={/pgf/number format/fixed,
          /pgf/number format/precision=2,/pgf/number format/fixed zerofill,
          /pgf/number format/1000 sep = %\thinspace % Optional to replace comma as the 1000 separator 
        },
        major tick length=0pt,legend columns=1, 
        legend style={,xshift=-.5in,yshift=.2in},
        xlabel={},xticklabel style={yshift=-.05in},
        xlabel style={yshift=0.1in},ylabel
        style={xshift=-1in},ylabel={PPV},
        grid style={thick,dashed, gray!40},
        point meta min=0.92, point meta max=0.98,
        title style={yshift=.0in,xshift=-.2in,align=left}]

        \nextgroupplot[ymin=0.14,ymax=.35,xmin=.35,xmax=.65,text=\TEXTCOL, height=\HGTa,
        width=\WDTa,title={{\Large i.} 24 month, Male Truven}]
        \addplot[only marks,scatter,scatter src=explicit, mark options={%
          mopt,
        },]table[col sep=comma,x=s, y=p,meta=c]
        {\datafile};
        \node[,thick,anchor=center,] (x1t) at (axis cs:.388,0.145) {};
        \node[thick,anchor=center,] (x2t) at (axis cs:.388,0.29) {};
        \node[thick,anchor=center,] (x3t) at (axis cs:.54,0.162) {};

        \nextgroupplot[ymin=0.14,ymax=.35,xmin=.35,xmax=.65,text=\TEXTCOL, height=\HGTa,
        width=\WDTa,ylabel={},title={{\Large ii.} 24 month, Female Truven}]
        \addplot[only marks,scatter,scatter src=explicit, mark options={%
          mopt,
        },]table[col sep=comma,x=s, y=p,meta=c]
        {\datafilef};
        \node[,thick,anchor=center,] (x1) at (axis cs:.388,0.145) {};
        \node[thick,anchor=center,] (x2) at (axis cs:.388,0.35) {};
        \node[thick,anchor=center,] (x3) at (axis cs:.57,0.17) {};
        % \draw[->,>=stealth',thick,dashed] (x1) -- (x2);
        % \addplot[mark=*, only marks, mark options={scale=.4,fill=black}]table[col sep=comma,x=s, y=p]
        % {\datafileHp};

        \nextgroupplot[ymin=0.14,ymax=.35,xmin=.35,xmax=.65,text=\TEXTCOL, height=\HGTa,
        width=\WDTa,ylabel={}, ,title={{\Large iii.} 24 month, Male UCM}]
        \addplot[only marks,scatter,scatter src=explicit, mark options={%
          mopt,
        },]table[col sep=comma,x=s, y=p,meta=c]
        {\vdatafile};
        \node[,thick,anchor=center,] (x1u) at (axis cs:.388,0.145) {};
        \node[thick,anchor=center,] (x2u) at (axis cs:.388,0.35) {};
        \node[thick,anchor=center,] (x3u) at (axis cs:.63,0.15) {};

        \nextgroupplot[ymin=0.14,ymax=.35,xmin=.35,xmax=.65,text=\TEXTCOL, height=\HGTa,
        width=\WDTa,ylabel={}, extra x ticks={.3},,title={{\Large iv.} 24 month, Female UCM}]
        \addplot[only marks,scatter,scatter src=explicit, mark options={%
          mopt,
        },]table[col sep=comma,x=s, y=p,meta=c]
        {\vdatafilef};
        \node[,thick,anchor=center,] (x1f) at (axis cs:.388,0.145) {};
        \node[thick,anchor=center,] (x2f) at (axis cs:.388,0.31) {};
        \node[thick,anchor=center,] (x3f) at (axis cs:.62,0.15) {};
      \end{groupplot}

      \node[draw=IndianRed1,fill=none,thick,anchor=center,
      label={[text=IndianRed1]0:HP$^\dag$}] (x2t) at (x2t) {}; 
      \node[draw=IndianRed1,fill=none,thick,anchor=center,
      label={[text=IndianRed1,fill=white]80:HR$^\dag$}] (x3t) at (x3t) {};
      \draw[-{latex},IndianRed1,ultra thick,dashed] (x1t) -- (x2t);
      \draw[-{Latex},IndianRed1,ultra thick,dashed] (x1t) -- (x3t);
      \node[draw=IndianRed4,fill=IndianRed2,thick,anchor=center,
      label={[text=IndianRed1,fill=white,font=\bf\sffamily\fontsize{6}{7}\selectfont,
        label distance=0.02in]-120:MCHAT-F}] (x1t) at (x1t) {};


      \node[draw=IndianRed1,fill=none,thick,anchor=center,label={[text=IndianRed1]0:HP$^\dag$}] (x2u) at (x2u) {}; 
      \node[draw=IndianRed1,fill=none,thick,anchor=center,
      label={[text=IndianRed1,fill=white]80:HR$^\dag$}] (x3u) at (x3u) {};
      \draw[-{latex},IndianRed1,ultra thick,dashed] (x1u) -- (x2u);
      \draw[-{Latex},IndianRed1,ultra thick,dashed] (x1u) -- (x3u);
      \node[draw=IndianRed4,fill=IndianRed2,thick,anchor=center,label={[text=IndianRed1,
        fill=white,font=\bf\sffamily\fontsize{6}{7}\selectfont,
        label distance=0.02in]-120:MCHAT-F}] (x1u) at (x1u) {};



      \node[draw=IndianRed1,fill=none,thick,anchor=center,
      label={[text=IndianRed1]0:HP$^\dag$}] (x2) at (x2) {}; 
      \node[draw=IndianRed1,fill=none,thick,anchor=center,
      label={[text=IndianRed1,fill=white]80:HR$^\dag$}] (x3) at (x3) {};
      \draw[-{latex},IndianRed1,ultra thick,dashed] (x1) -- (x2);
      \draw[-{Latex},IndianRed1,ultra thick,dashed] (x1) -- (x3);
      \node[draw=IndianRed4,fill=IndianRed2,thick,anchor=center,
      label={[text=IndianRed1,fill=white,font=\bf\sffamily\fontsize{6}{7}\selectfont,
        label distance=0.02in]-120:MCHAT-F}] (x1) at (x1) {};


      \node[draw=IndianRed1,fill=none,thick,anchor=center,
      label={[text=IndianRed1]0:HP$^\dag$}] (x2f) at (x2f) {};
      \node[draw=IndianRed1,fill=none,thick,anchor=center,
      label={[text=IndianRed1,fill=white]90:HR$^\dag$}] (x3f) at (x3f) {};
      \draw[-{latex},IndianRed1,ultra thick,dashed,opacity=1] (x1f) -- (x2f);
      \draw[-{Latex},IndianRed1,ultra thick,dashed,opacity=1] (x1f) -- (x3f);
      \node[draw=IndianRed4,fill=IndianRed2,thick,anchor=center,
      label={[text=IndianRed1,fill=white,font=\bf\sffamily\fontsize{6}{7}\selectfont,
        label distance=0.02in]-120:MCHAT-F}] (x1f) at (x1f) {};
    \end{tikzpicture}};

  \node[anchor=north east] (B) at ([yshift=.65in,xshift=-.1in]A.north west)
  {
  \def\TEXTCOL{gray}

  \def\DATAPATH{../../revision_results/roc/restricted_neg_len/RAW/}
  \def\datafile{\DATAPATH/RAWPRCpipeline_BASIC_M_150w.csv}
  \def\datafileF{\DATAPATH/RAWPRCpipeline_BASIC_F_150w.csv}
  \def\datafileU{\DATAPATH/RAWPRCvalid_BASIC_M_150w.csv}
  \def\datafileUF{\DATAPATH/RAWPRCvalid_BASIC_F_150w.csv}

  \def\datafileh{\DATAPATH/RAWPRCpipeline_BASIC_M_100w.csv}
  \def\datafileFh{\DATAPATH/RAWPRCpipeline_BASIC_F_100w.csv}
  \def\datafileUh{\DATAPATH/RAWPRCvalid_BASIC_M_100w.csv}
  \def\datafileUFh{\DATAPATH/RAWPRCvalid_BASIC_F_100w.csv}

  \def\AXISCOL{white}
  \def\HGT{1.55in}
  \def\WDT{1.6in}
  \def\MXCOLB{gray}
  \def\FXCOLB{CadetBlue3}
  \def\OPC{.75}
  \def\OPCB{.65}
  \def\LWDT{.8mm}
  \def\SKIP{7}

    \begin{tikzpicture}[text=\TEXTCOL, ]
      \begin{groupplot}
        [name=Agg,
        group style={
          group name=Ag,
          group size=1 by 2,
          %xlabels at=edge bottom,
          %xticklabels at=edge bottom,
          vertical sep=.8in,
          % horizontal sep=.55in,
        },        ,legend cell align={left},
        legend style={anchor=east,at={(-0.25,1.1)},
          inner sep=3pt,
          draw=none,
          fill=white,fill opacity=.850,
          align=left,anchor=west,
          text opacity=1,
          font=\bf\sffamily\fontsize{8}{9}\selectfont,text=black},legend columns=2, 
        name=K,
        clip=true,,
        width=\WDT,
        height=\HGT,
        scale only axis=true,
        enlargelimits=false,
        axis on top=false,
        % axis background/.style={
        %   shade,top color=transparent!5,bottom color=transparent!5},
        axis line style={\AXISCOL, opacity=1,ultra  thick, 
          rounded corners=0pt}, 
        grid,
        grid style={thick,dashed, gray!40},
         xticklabel style={yshift=-.05in},
        xlabel style={yshift=-.075in,text=\TEXTCOL},
        ylabel style={align=center,,text=\TEXTCOL,anchor=center,
          yshift=-.175in},
        % tickpos=left,
        ytick align=outside,
        xtick align=outside,
        major tick length=0pt,
        scaled y ticks = false,
        y tick label style={/pgf/number format/fixed,
          /pgf/number format/1000 sep = \thinspace % Optional if you00 separator 
        },
        ylabel={PPV},xlabel={sensitivity (TPR)},title style={text=\TEXTCOL, yshift=.25in,xshift=-1.25in,anchor=south west},
        % extra x ticks={1},extra x tick labels={1}
        ]

        \nextgroupplot[ xlabel={}, xmin=0.03, ymax=0.7,title={{\Large i. } 150 weeks},]
        \addplot [each nth point=\SKIP, filter discard warning=false, 
        unbounded coords=discard,smooth,draw=\MXCOL, line width=\LWDT,opacity=\OPC,
        ]table [col sep=comma,x=tpr,y=p] {\datafile};
        \addlegendentry{Male Truven}

        \addplot [each nth point=\SKIP, filter discard warning=false, 
        unbounded coords=discard,smooth,draw=\FXCOL,  line width=\LWDT,,opacity=\OPC,
        ]table [col sep=comma,x=tpr,y=p] {\datafileF};
        \addlegendentry{Female Truven}

        \addplot [each nth point=\SKIP, filter discard warning=false, 
        unbounded coords=discard,smooth,draw=\MXCOLB,  line width=\LWDT,,opacity=\OPC,
        ]table [col sep=comma,x=tpr,y=p] {\datafileU};
        \addlegendentry{Male UCM}

        \addplot [each nth point=\SKIP, filter discard warning=false, 
        unbounded coords=discard,smooth,draw=\FXCOLB,  line width=\LWDT,,opacity=\OPC,
        ]table [col sep=comma,x=tpr,y=p] {\datafileUF};
        \addlegendentry{Female UCM}


        \nextgroupplot[ xlabel={sensitivity (TPR)},xmin=0.03, ymax=0.7,,title={{\Large ii. } 100 weeks}]
        \addplot [each nth point=\SKIP, filter discard warning=false, 
        unbounded coords=discard,smooth,draw=\MXCOL, line width=\LWDT,,opacity=\OPC,
        ]table [col sep=comma,x=tpr,y=p] {\datafileh};
        \addlegendentry{Male Truven}

        \addplot [each nth point=\SKIP, filter discard warning=false, 
        unbounded coords=discard,smooth,draw=\FXCOL,  line width=\LWDT,,opacity=\OPC,
        ]table [col sep=comma,x=tpr,y=p] {\datafileFh};
        \addlegendentry{Female Truven}

        \addplot [each nth point=\SKIP, filter discard warning=false, 
        unbounded coords=discard,smooth,draw=\MXCOLB,  line width=\LWDT,,opacity=\OPC,
        ]table [col sep=comma,x=tpr,y=p] {\datafileUh};
        \addlegendentry{Male UCM}

        \addplot [each nth point=\SKIP, filter discard warning=false, 
        unbounded coords=discard,smooth,draw=\FXCOLB,  line width=\LWDT,,opacity=\OPC,
        ]table [col sep=comma,x=tpr,y=p] {\datafileUFh};
        \addlegendentry{Female UCM}
      \end{groupplot}\end{tikzpicture}
  };
% \node[anchor=north] (CC) at ($(A.south east)!.5!(B.south west)$) {\begin{tikzpicture}[font=\bf\sffamily\fontsize{8}{10}\selectfont]
%   \def\TEXTCOL{gray}
%   \def\DATAPATH{../../revision_results/roc/restricted_neg_len/RAW/}
%   \def\datafile{\DATAPATH/thisRFall.csv}
%   \def\AXISCOL{white}
%   \def\WDTa{1.85in}
%   \def\HGTa{2in}
%   \def\HGT{1.2in}
%   \def\WDT{1.2in}
%   \def\MXCOLB{gray}
%   \def\FXCOLB{CadetBlue3}
%   \def\OPC{.75}
%   \def\OPCB{.65}
%   \def\LWDT{0.8mm}
%   \def\SKIP{4}
%   \node[] (A0) at (0,0) {};
%   \node[anchor=center] (N) at (A0.south)
%   {
%     \begin{tikzpicture}[text=\TEXTCOL, ]
%       \begin{groupplot}
%         [name=Agg,
%         group style={
%           group name=Ag,
%           group size=3 by 1,
%           xlabels at=edge bottom,
%           xticklabels at=edge bottom,
%           vertical sep=.75in,
%           horizontal sep=.9in,
%         },        ,legend cell align={left},
%         legend style={anchor=east,at={(-0.12,1.1)},
%           inner sep=3pt,
%           draw=none,
%           fill=white,fill opacity=.850,
%           align=left,anchor=west,
%           text opacity=1,
%           font=\bf\sffamily\fontsize{8}{9}\selectfont,text=black},legend columns=2, 
%         name=K,
%         clip=true,,
%         width=\WDT,
%         height=\HGT,
%         scale only axis=true,
%         enlargelimits=false,
%         axis on top=false,
%         % axis background/.style={
%         % shade,top color=transparent!5,bottom color=transparent!5},
%         axis line style={\AXISCOL, opacity=1,ultra  thick, 
%           rounded corners=0pt}, 
%         grid,
%         grid style={thick,dashed, gray!40},
%         % xticklabel style={xshift=0.05in,yshift=-.05in},
%         xlabel style={yshift=.05in,text=\TEXTCOL},
%         ylabel style={align=center,,text=\TEXTCOL,anchor=center,
%           yshift=-.175in},
%         % tickpos=left,
%         ytick align=outside,
%         xtick align=outside,
%         major tick length=0pt,
%         scaled y ticks = false,
%         y tick label style={/pgf/number format/fixed,
%           /pgf/number format/1000 sep = \thinspace % Optional if you00 separator 
%         },
%         ylabel={PPV},xlabel={sensitivity (TPR)},point meta=explicit,
%         colorbar style={width=.1in,y tick label style={/pgf/number format/fixed,/pgf/number format/precision=3,/pgf/number format/fixed zerofill,
%             /pgf/number format/1000 sep = %\thinspace % Optional if you want to replace comma as the 1000 separator 
%           },}
%         ]

%         \nextgroupplot[colorbar]
%         \pgfplotsset{
%           colormap={hot}{color(0cm)=(MidnightBlue); color(1cm)=(CadetBlue2!90!black); color(2cm)=(CadetBlue1!93!black); color(3cm)=(Bisque1!93!black); color(4cm)=(DarkOrange1); color(5cm)=(Yellow2!93!black)}
%         }
%         \addplot [mesh, very thick, %point meta min=0.92, point meta max=0.98
% ]table [col sep=comma,x=s,y=p,meta=c,
%         % discard if not={gender}{M},
%         restrict expr to domain={\thisrow{c}}{0.966:1},restrict expr to domain={\thisrow{rho}}{0.012:1}] {\datafile};

%         \nextgroupplot[colorbar,ylabel={}]
%         \pgfplotsset{
%           colormap={hot}{color(0cm)=(lightgray!70); color(1cm)=(lightgray!80); color(2cm)=(lightgray!80!Bisque1); color(3cm)=(Bisque1!90!Tomato); color(4cm)=(Tomato); color(5cm)=(Red1)}
%         }
%         \addplot [mesh, very thick]table [col sep=comma,x=s,y=p,meta=rho,
%         % discard if not={gender}{M},
%         restrict expr to domain={\thisrow{c}}{0.966:1},restrict expr to domain={\thisrow{rho}}{0.012:1}] {\datafile};

%         \nextgroupplot[colorbar,ylabel={}]
%         \pgfplotsset{
%           colormap={hot}{color(0cm)=(lightgray!70); color(1cm)=(lightgray!80); color(2cm)=(lightgray!80!Bisque1); color(3cm)=(Bisque1!90!Tomato); color(4cm)=(Tomato); color(5cm)=(Red1)}
%         }
%         \addplot [mesh, very thick]table [col sep=comma,x=rs,y=tm,meta=rho,
%         discard if not={gender}{M},
%         restrict expr to domain={\thisrow{c}}{0.95:1},
%         restrict expr to domain={\thisrow{rho}}{0.016:0.0224},
%         restrict expr to domain={\thisrow{rs}}{1:1.5},
%         ] {\datafile};
%       \end{groupplot}
%     \end{tikzpicture}
%   };
%\end{tikzpicture}
%};
 

  \node[anchor=north,font=\bf\sffamily\fontsize{8}{10}\selectfont,
  text=\TEXTCOL] (CC) at ([yshift=0in]A.south) {sensitivity (TPR)};

  \node[anchor=south] (CB) at ([yshift=.05in]A.north) {
    \begin{tikzpicture}[font=\bf\sffamily\fontsize{8}{10}\selectfont,
      text=\TEXTCOL]
      \begin{axis}[,
        hide axis,
        scale only axis,
        height=0pt,
        width=0pt,
        colorbar horizontal,
        point meta min=0.92,
        point meta max=0.98,
        colorbar style={
          title={specificity},title style={yshift=-.1in},
          width=3in,
          height=.15in,
          xticklabel style={yshift=-.05in},
          xtick={0.92,0.93,0.94,.95,0.96,0.97,0.98}
        }]
        \addplot [draw=none] coordinates {(0,0)};
      \end{axis}
    \end{tikzpicture}};

  \node[anchor=south west] (L1) at ([xshift=-.05in]CB.north west) {{\Large B.} 4D  Optimization Conditioned  on MCHAT-F To Boost Performance$^\ddag$};
 \node[anchor=south west] (L2) at ([xshift=.75in,yshift=-.01in]$(L1.south west) !(B.west)!(L1.south east)$) {{\Large A.} PPV/Sesnitivity or Precision/Recall Curves};

\end{tikzpicture}

